<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><base href="/"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="design/index.css"><title>Working With Data Models | Hitchy</title></head><body class="page"><div id="wrapper"><div id="north"><div class="navigation"><nav class="primary center-block"><ul><li class="item"><a href="">Home</a></li><li class="item"><a href="about/">About</a></li><li class="item"><a href="download/">Download</a></li><li class="selected item"><a href="getting-started/">Getting Started</a></li><li class="item"><a href="concepts/">Concepts</a></li><li class="item"><a href="runtime/">At Runtime</a></li><li class="item"><a href="extensions/">Extensions</a></li></ul><div class="boilerplate"><div class="site-title">Hitchy</div><div class="site-subtitle">a Javascript-based web application framework</div></div></nav></div><div class="center-block"><h1>Working With Data Models</h1></div></div><div id="main"><div class="columnizer"><div id="core"><article class="center-block"><h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>Hitchy has its own object document manager (ODM) called <a href="https://www.npmjs.com/package/hitchy-odem" target="_blank" rel="noopener">odem</a>. It comes with its own concept for implementing data models for managing instances of either model. It’s API is designed to be quite similar to key-value based databases such as LevelDB. Currently it includes an adapter for temporarily managing data in memory. A second adapter supports managing data in a folder of your file system. Further adapter will be created e.g. for interacting with LevelDB backends such as Hitchy’s Raft consensus cluster called <a href="https://www.npmjs.com/package/scull" target="_blank" rel="noopener">scull</a>.</p>
<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>A separate package called <a href="https://www.npmjs.com/package/hitchy-plugin-odem-rest" target="_blank" rel="noopener">hitchy-plugin-odem-rest</a> provides a REST-like API for accessing Hitchy’s ODM out of the box. By installing it as dependency the underlying <a href="https://www.npmjs.com/package/hitchy-odem" target="_blank" rel="noopener">hitchy-odem</a> gets installed implicitly as well.</p>
<ol>
<li><p>Run this command using your CLI while residing in directory containing your base project:<br><code>npm i -S hitchy-plugin-odem-rest</code></p>
</li>
<li><p>Create new folder <strong>api/model</strong> inside your Hitchy project (which is the one in subfolder <strong>server</strong> in case of you’ve been starting off with a VueJS project before).</p>
</li>
<li><p>Put a file <strong>person.js</strong> into that folder containing this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   	attributes: &#123;</span><br><span class="line">   		salutation: &#123;&#125;,</span><br><span class="line">   		title: &#123;&#125;,</span><br><span class="line">   		firstName: &#123;&#125;,</span><br><span class="line">   		lastName: &#123;&#125;,</span><br><span class="line">   		company: &#123;&#125;,</span><br><span class="line">   		address: &#123;&#125;,</span><br><span class="line">   		zip: &#123;&#125;,</span><br><span class="line">   		locality: &#123;&#125;,</span><br><span class="line">   		phone: &#123;&#125;,</span><br><span class="line">   		mail: &#123;&#125;,</span><br><span class="line">   	&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This is declaring a data model named <strong>person</strong> consisting of a set of attributes each of type <strong>string</strong> implicitly. There are no constraints declared on any attribute which is available, too. But for the sake of demonstrating a minimum declaration of a model we stick with this example.</p>
</li>
<li><p>Restart Hitchy.</p>
</li>
</ol>
<h1 id="Manually-Control-Data"><a href="#Manually-Control-Data" class="headerlink" title="Manually Control Data"></a>Manually Control Data</h1><p>The following examples demonstrate how to control data in your defined model using browser.</p>
<ol>
<li><p><strong>List available instances:</strong> Open your browser at URL <a href="http://localhost:3000/api/person" target="_blank" rel="noopener">http://localhost:3000/api/person</a>. As you haven’t created any model instances yet, the result is an empty list:<br><img src="/images/hitchy-odm-initial.png" alt=""></p>
</li>
<li><p><strong>Create new instance:</strong> Switch to URL <a href="http://localhost:3000/api/person/create?lastName=Doe&amp;firstName=John" target="_blank" rel="noopener">http://localhost:3000/api/person/create?lastName=Doe&amp;firstName=John</a>. You should see something like this, though the displayed UUID might be different for sure:<br><img src="/images/hitchy-odem-first-created.png" alt=""></p>
</li>
<li><p>Return to the previous URL. You might need to reload the page due to browser’s caching. But eventually there is a record listed now.<br><img src="/images/hitchy-odm-list-created.png" alt=""></p>
</li>
<li><p><strong>Write single property of existing instance:</strong> Copy the UUID listed in your output and replace <code>&lt;uuid&gt;</code> in URL <a href="http://localhost:3000/api/person/write/&lt;uuid&gt;?phone=555+12345" target="_blank" rel="noopener">http://localhost:3000/api/person/write/&lt;uuid&gt;?phone=555+12345</a> with that UUID. Query the resulting URL with your browser. The output should be equivalent to the one in step 6 before.</p>
</li>
<li><p>Return to the URL used in steps 1 and 3 again. This time there is the phone number you’ve added.<br><img src="/images/hitchy-odm-phone-added.png" alt=""></p>
</li>
<li><p><strong>Feed the list:</strong> Create a second person using URL <a href="http://localhost:3000/api/person/create?lastName=Doe&amp;firstName=Jane" target="_blank" rel="noopener">http://localhost:3000/api/person/create?lastName=Doe&amp;firstName=Jane</a>. (<strong>Note the adjusted <code>firstName</code>!</strong>) Return to the previous URL again:<br><img src="/images/hitchy-odm-added-record.png" alt=""></p>
</li>
<li><p><strong>Search the model:</strong> Open URL <a href="http://localhost:3000/api/person/find/firstName/eq/Jane" target="_blank" rel="noopener">http://localhost:3000/api/person/find/firstName/eq/Jane</a>. This time you get a list consisting of the second instance created right before due to matching search criteria <code>firstName</code> <code>eq</code>uals <code>Jane</code>:<br><img src="/images/hitchy-odm-find.png" alt=""></p>
</li>
<li><p><strong>Limit the results:</strong> Extend URL used to query model before or the URL used initially to list all records by parameters <code>offset</code> and/or <code>limit</code> skip some listed records or limit number of resulting records, e.g. </p>
<ul>
<li><p><a href="http://localhost:3000/api/person?offset=1" target="_blank" rel="noopener">http://localhost:3000/api/person?offset=1</a> or</p>
</li>
<li><p><a href="http://localhost:3000/api/person/find/firstName/eq/Jane?limit=1" target="_blank" rel="noopener">http://localhost:3000/api/person/find/firstName/eq/Jane?limit=1</a>.</p>
</li>
</ul>
</li>
</ol>
<p>See the full list of available URLs per model in <a href="https://www.npmjs.com/package/hitchy-plugin-odem-rest" target="_blank" rel="noopener">documentation of hitchy-plugin-odem-rest</a>.</p>
<h1 id="Persisting-Your-Data"><a href="#Persisting-Your-Data" class="headerlink" title="Persisting Your Data"></a>Persisting Your Data</h1><p>Until now all data was backed using a default adapter which happens to use computer’s volatile memory thus loosing all data on restarting Hitchy. This is great for testing but it won’t help to get become production-ready. You can fix this by configuring different default adapter to be used.</p>
<p><strong>hitchy-odem</strong> includes <code>FileAdapter</code> storing all data in a folder of your file system. This adapter is anything but performant and definitely not suitable for large-scale applications. But it’s sufficient to extend your next web application to a production-ready first prototype.</p>
<blockquote>
<p>Keep waiting for an adapter connecting with a LevelDB backend or similar.</p>
</blockquote>
<ol>
<li><p>Create folder <strong>server/data</strong> to contain your data.</p>
</li>
<li><p>Create file <strong>server/config/database.js</strong> and put this content:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Path = <span class="built_in">require</span>( <span class="string">"path"</span> );</span><br><span class="line"><span class="keyword">const</span> &#123; FileAdapter &#125; = <span class="built_in">require</span>( <span class="string">"hitchy-odem"</span> );</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	database: &#123;</span><br><span class="line">		<span class="keyword">default</span>: <span class="keyword">new</span> FileAdapter( &#123;</span><br><span class="line">			dataSource: Path.resolve( __dirname, <span class="string">"../data"</span> )</span><br><span class="line">		&#125; ),</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>This file is adjusting configuration option <strong>config.database.default</strong> which is read by <strong>hitchy-odem</strong> on selecting default adapter to use with every model created. On next restart Hitchy is going to create all data model instances in created folder.</p>
</article></div><div id="left"><nav class="sub navigation"><ul><li class="item"><a href="getting-started/installation.html">Installation</a></li><li class="item"><a href="getting-started/routes.html">Routes</a></li><li class="item selected"><a href="getting-started/odm.html">Odm</a></li></ul></nav></div><div id="right"></div></div></div><div id="south"><div class="center-block"><div class="copyright">&copy; 2018 <a href="http://cepharum.de" target="_blank">cepharum GmbH</a></div> - <nav class="footer"><ul><li class="item"><a href="imprint/">Imprint</a></li></ul></nav> - <div class="timestamp">Last Update: July 22, 2018 1:24 AM</div></div></div></div><script type="text/javascript" src="js/fx.js"></script></body></html>